<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <?!= HtmlService.createHtmlOutputFromFile('common_ui').getContent(); ?>
</head>
<body onload="checkEnvironment();">
  <div class="app">
    <div class="header">
      <div class="titleWrap">
        <h1 class="title">FIX（修正申請）</h1>
        <p class="subtitle">危険修正はフォーム申請のみ（Request シートに記録）。</p>
      </div>
      <div class="pill warn">判断はGAS（AIはテンプレ補助のみ）</div>
    </div>

    <div class="card">
      <div class="cardHeader"><h2>入力</h2></div>
      <div class="cardBody">
        <div class="field">
          <label>category</label>
          <select id="category">
            <option>発注キャンセル（返品可）</option>
            <option>発注キャンセル（返品不可）</option>
            <option>納品キャンセル（返品可）</option>
            <option>納品キャンセル（返品不可）</option>
            <option>区分変更（BP↔BM）</option>
            <option>入り値修正</option>
            <option>欠番扱い</option>
            <option>在庫切離し</option>
          </select>
        </div>
        <div class="field">
          <label>content</label>
          <textarea id="content" placeholder="修正内容を記載"></textarea>
        </div>
        <div class="btns">
          <button class="btn ghost" onclick="showTemplate();">テンプレ補助（表示のみ）</button>
          <button class="btn primary" id="btnSubmit" onclick="submitFIX();">送信（Requestへ）</button>
        </div>
      </div>
    </div>
  </div>

<script>
  function showTemplate(){
    alert('テンプレ例:\n1 対象ID\n2 新しい値\n（AI補助は素材生成のみ。正式判断はGAS）');
  }
  function submitFIX(){
    var btn = qs('#btnSubmit');
    showBusy(btn, true);
    var payload = {
      category: qs('#category').value,
      content: qs('#content').value || ''
    };
    google.script.run
      .withSuccessHandler(function(res){ showBusy(btn,false); alert('送信しました'); })
      .withFailureHandler(function(err){ showBusy(btn,false); alert('エラー: ' + (err && err.message ? err.message : err)); })
      .formSubmitFIX(payload);
  }
</script>
</body>
</html>
