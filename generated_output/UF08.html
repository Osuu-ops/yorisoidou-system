<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <?!= HtmlService.createHtmlOutputFromFile('common_ui').getContent(); ?>
</head>
<body onload="checkEnvironment();">
  <div class="app">
    <div class="header">
      <div class="titleWrap">
        <h1 class="title">UF08（追加報告）</h1>
        <p class="subtitle">追加写真／追加説明を Order に紐づけます（photos/extra と logs/extra）。</p>
      </div>
      <div class="pill warn">写真分類：AIは補助のみ（判断はGAS）</div>
    </div>

    <div class="card">
      <div class="cardHeader"><h2>入力</h2></div>
      <div class="cardBody">
        <div class="field">
          <label>OrderID</label>
          <input id="orderId" type="text" placeholder="orderPrefix-YYYYMMDD-00001-UP...">
        </div>
        <div class="field">
          <label>メモ</label>
          <textarea id="memo" placeholder="追加報告の内容"></textarea>
        </div>
        <div class="field">
          <label>写真（ファイル）</label>
          <input id="photo" type="file" accept="image/*" capture="environment">
          <p class="help">注：Apps Script HTML のファイルアップロードは実装方式が複数あり、ここでは推測実装しません（仕様外の推測追加禁止）。</p>
        </div>

        <div class="btns">
          <button class="btn primary" id="btnSubmit" onclick="submitUF08();">送信（GAS）</button>
        </div>
      </div>
    </div>
  </div>

<script>
  function submitUF08(){
    var btn = qs('#btnSubmit');
    showBusy(btn, true);
    var payload = {
      orderId: qs('#orderId').value || '',
      memo: qs('#memo').value || ''
    };
    google.script.run
      .withSuccessHandler(function(res){ showBusy(btn,false); alert('送信しました'); })
      .withFailureHandler(function(err){ showBusy(btn,false); alert('エラー: ' + (err && err.message ? err.message : err)); })
      .onUF08Submit(payload);
  }
</script>
</body>
</html>
