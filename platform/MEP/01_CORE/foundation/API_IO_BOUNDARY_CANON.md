# API_IO_BOUNDARY_CANON
（API 実装前提・入出力境界の固定定義）

本書は、MEP を API 実装へ移行する際の
**入出力境界・書換権限・検査点**を固定定義する Canon である。

本書は実装コードを定義しない。
本書は遷移や判断を追加しない。

---

## 1. 入力区分（Input Domains）

### 1.1 Read-Only Inputs（書換不可）

以下は **常に read-only** とする。

- X：最新確定仕様（唯一の正）
- S：最新確定成果物（唯一の正）
- Canon / Protocol / Master 文書

これらは API に入力として渡され得るが、
**出力として再生成・修正・上書きしてはならない。**

---

### 1.2 Write-Only Inputs（差分のみ許可）

書換が許可される入力は **diff のみ**とする。

- unified diff 形式
- 行削除・行置換・行追加が明示されたもの

全文テキストの直接入力は許可しない。
全文置換は **人間が明示指定した場合のみ**許可する。

---

## 2. 中間生成物（Candidates）

以下は **候補（candidate）**としてのみ扱う。

- 生成された仕様候補
- 生成されたコード候補
- 説明文・整理文・再構成文

candidate は **正ではない**。
candidate は **X / S に直接書き込めない**。

---

## 3. 検査点（Guards）

### 3.1 T / R の入力

- before（X または N）
- after（candidate）
- diff

T / R は、
**diff と参照テキストのみ**を入力として扱う。

---

### 3.2 Z の入力（最終ガード）

Z は以下のみを入力として扱う。

- diff
- 不変条件（公理）リスト

Z は以下を **行わない**。

- 意味解釈
- 評価
- 重み付け
- 裁量判断

Z は **Yes / No のみ**を返す。

---

## 4. 書込み権限（Write Permissions）

### 4.1 X への書込み

- 条件：
  - Z が OK を返した場合のみ
- 方法：
  - diff 適用のみ

Z OK 以前に、
X を更新してはならない。

---

### 4.2 S への書込み

- 条件：
  - Z が OK を返した生成物のみ
- 方法：
  - 生成物の保存

S は仕様確定点ではない。
S は成果物保存領域である。

---

## 5. 禁止事項（API レベル）

以下を理由の如何を問わず禁止する。

- read-only input の再生成
- candidate の自動確定
- Z NG 後の自動継続
- diff を伴わない書換
- 文脈・会話履歴を判断根拠に用いること

---

## 6. 最終確認

本定義は、

- API 実装の可否判定
- 実装前レビュー
- CI ガード条件

として使用できる。

本定義を満たさない実装は、
MEP の API 実装として不適合とする。

---

以上。
