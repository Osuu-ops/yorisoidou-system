name: UX Rooftop Entry (FULLAUTO)

on:
  workflow_dispatch:
    inputs:
      biz_key:
        description: "Business key (must exist in businesses/REGISTRY.yml). Default=yorisoidou"
        required: false
        default: "yorisoidou"      artifact_title:
        description: "Artifact title (short)"
        required: true
      artifact_markdown:
        description: "Artifact body (markdown)"
        required: true
      pr_body:
        description: "PR body"
        required: true
      merge_if_ok:
        description: "Merge automatically if gate OK (true/false)"
        required: false
        default: "true"

permissions:
  contents: write
  pull-requests: write

jobs:
  full-auto:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout main (fixed)
        uses: actions/checkout@v4
        with:
          ref: main
          fetch-depth: 0

      - name: Configure git
        shell: bash
        run: |
          set -euo pipefail
          BIZ="${{ github.event.inputs.biz_key }}"
          if [ -z "${BIZ}" ]; then BIZ="yorisoidou"; fi
          if [ ! -f "businesses/REGISTRY.yml" ]; then
            echo "businesses/REGISTRY.yml not found" >&2
            exit 1
          fi
          if ! grep -Eq "^[[:space:]]*-[[:space:]]*key:[[:space:]]*${BIZ}[[:space:]]*$" "businesses/REGISTRY.yml"; then
            echo "Unknown biz_key: ${BIZ}" >&2
            exit 1
          fi
          echo "biz_key=${BIZ}"