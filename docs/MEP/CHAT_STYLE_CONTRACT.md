# CHAT_STYLE_CONTRACT（引っ越し後も崩れない会話/コード運用規約）

本書は「新チャット/新アカウント/記憶0」でも、同じ進め方・同じコード提示形式で作業を継続するための規約である。
この規約は会話の記憶に依存しない。リポジトリが唯一の正。

## 0. 起動（最優先）
- 新チャット開始時、最初に mep（= tools/mep_chat_packet_min.ps1 出力）を貼る。
- AIは個別ファイルを10個要求してはいけない。必要なら「mepの再貼付」だけを要求する。

## 1. 進め方（固定）
- 1テーマ = 1PR
- すべてPowerShellで完結する
- 「作成→commit→push→PR作成→auto-merge予約→checks確認→origin/main反映確認→main clean」までを1ブロックで提示する

## 2. コード提示の形式（固定）
- PowerShellコマンドは必ず “1つのコードブロック” にまとめる（分割禁止）
- プレースホルダ（<ID> 等）禁止。ブロック内で自動取得/変数化して完結させる
- 説明文はPowerShellが壊れないよう、ブロック内は # コメントで書く（本文をそのままコピペしても動く）


## 2.1 PowerShell 表示の注意（固定）
- Write-Host の `-f` 書式は引数の解釈でエラー表示（"accepts at most 1 arg(s)" 等）を誘発しやすい。
- 表示は原則 `[string]::Format("x={0}", $x)` を使う（コピー実行時のノイズ削減）。


## 2.2 1ブロックの原子性（固定）
- 「1回コピペ」のブロックは必ず `& { ... }` で包む（途中で停止しても後続が走らない）。
- 途中停止は `return` を使う（貼り付け方式による暴発を防ぐ）。

## 2.3 gh --json の固定（固定）
- PowerShell は `a,b,c` を引数分割するため、`gh ... --json` は事故りやすい。
- 対策は2択のみ：
  1) `--json "a,b,c"` のように必ずクォートする
  2) もしくは `gh ... --json "a,b,c" | ConvertFrom-Json` でPowerShell側で扱う（推奨）

## 3. 例外時の挙動（固定）
- auto-merge待機の確認はブロック内で短時間ポーリングし、反映確認まで行う
- 失敗時は「失敗したチェック名」だけを貼らせ、次の1ブロックで最小修正する

## 4. 唯一の正（Yorisoidou BUSINESS）
- Canonical（実体）：platform/MEP/03_BUSINESS/よりそい堂/master_spec（拡張子なし）
- Entry（案内）：platform/MEP/03_BUSINESS/よりそい堂/master_spec.md（入口）

## 5. IDEA統合タイミング（固定）

前提：
- CHAT_PACKET_MIN には docs/MEP/IDEA_INDEX.md が同梱される（存在する場合）。
- IDEA_INDEX は番号（1,2,3...）で統合対象を選ぶ一覧であり、会話と統合の起点となる。

AIの義務（固定）：
- 新チャット開始時（mep貼付後）、AIは必ず「IDEA統合タイミング提案」を短く提示する。
- 提案は “実装ではなく統合順” に限定し、次の観点で分類する：
  1) 統合先：master_spec（業務意味/必須条件/状態遷移/確定ルール） / ui_spec（表示・導線） / tools/docs（運用・手順）
  2) 優先度：NOW（今のテーマに直結） / NEXT（次のテーマで統合） / LATER（実装段階で統合）
  3) 理由：依存関係（上流→下流）、事故防止、監督/現場負荷、整合性ガードの観点

統合の実行（固定）：
- 実際の統合は 1テーマ=1PR で行う。
- AIは番号を使って「pick → finalize（PR作成→auto-merge→main clean）」の1ブロック手順を提示する。
- ユーザーが「統合は後で」と言った場合、AIは capture/list の運用だけ維持し、強制統合しない。
