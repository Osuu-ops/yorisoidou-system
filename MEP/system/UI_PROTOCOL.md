<!--
参照定義ファイル：
MEP/definitions/SYMBOLS.md

運用ルール：
本ファイル内に出現するすべての参照記号（@Sxxxx）は、
個別指定や列挙を行わず、
上記「参照定義ファイル」を唯一の正として解決する。

本ファイルは、参照関係の宣言・管理を行わない。
-->



UI_PROTOCOL

MEP Form UI ― UI 統治・意味仕様（唯一の正）

1. 本書の位置づけ

本書（UI_PROTOCOL）は、
MEP Form UI における UI の振る舞い・意味・責務を統治する唯一の正である。

本書は、
ユーザーが画面を見たときに

今、何が起きているのか

今はどの状態なのか

次に何が起きうるのか

を 一貫した意味として理解できるようにするための UI 統治仕様を定義する。

本書は以下を 定義しない。

操作手順書

業務仕様（master_spec）

システム統治仕様（system_protocol）

本書の唯一の目的は、以下である。

UI がユーザーに伝えるべき意味を固定し、
説明コストと誤解を最小化すること

2. UI の基本思想
2.1 操作ではなく「状態」を示す UI

本 UI は、

「どのボタンを押すか」を教える UI ではなく、
「今どの状態にいるか」を示す UIである。

ユーザーが理解すべきことは、以下のみである。

今はどの状態か

この状態では何ができるか

何が起きれば次に進むのか

UI は、これ以上の判断をユーザーに要求してはならない。

2.2 内部フェーズと UI 表示の分離

内部で使用される以下の概念は、
UI 表示の正ではない。

M / P / E

A / B / T / C / D / R / S

progress / audit / runtime

UI では、人が直感的に理解できる
**「UI 状態名」**のみを正とする。

内部状態と UI 状態は、
常に分離して管理されなければならない。

UI 状態名は、ユーザーが理解しやすい日本語表記を正とし、
内部実装上の識別子（英字・コード名）をUI仕様として定義しない。

本 UI_PROTOCOL に定義された内容は、
UI_spec 側に重複して記述してはならない。

UI の原則、状態定義、操作制約、エラーの意味付け等については、
本 UI_PROTOCOL を唯一の正とし、
UI_spec はそれらを前提として適用結果のみを記述する。

UI_spec 側に同一内容が記載されている場合、
それは設計上の重複とみなし、UI_spec 側の記述を削除する。



3. UI 状態一覧（人向け定義）

本 UI において、
ユーザーが認識すべき状態は以下に限定される。

未開始

編集中

処理中

業務エラー（監査 NG）

システムエラー

完了

※ UI 状態は 同時に複数成立しない。

4. 各 UI 状態の定義
4.1 未開始

意味

まだ作業は始まっていない

内容の編集も処理も行われていない

UI 表示例

状態：未開始

表示される操作

編集する（B）

4.2 編集中（B）

意味

内容（カルテ／マスタ）を考え、入力している途中

処理は実行されていない

UI 表示例

状態：編集中

表示される操作

一時保存（カルテ／マスタ）

補足

編集中は進捗表示（スピナー等）を行わない

編集内容は、保存されるまで確定しない

4.3 処理中

意味

システムが保存・監査・生成等の処理を実行している状態

ユーザーは結果を待つのみである

UI 表示例

状態：処理中

UI 挙動

進捗表示（％表示またはスピナー）を表示する

表示される操作

中断

4.4 業務エラー（監査 NG）

意味

入力内容に不備があり、業務的に処理できない状態

内容を修正すれば再度進めることができる

UI 表示例

状態：内容に不備があります

表示される操作

修正（R）

重要事項

業務エラーは 業務内容の問題である

システム自体は正常に動作している

4.5 システムエラー

意味

保存失敗、通信失敗、例外等により
処理そのものが失敗した状態

業務内容の正否とは無関係

UI 表示例

状態：システムエラー

表示される操作

キャンセル

重要事項

修正（R）は表示しない

再試行は行わない（現段階）

4.6 完了

意味

処理が正常に完了した状態

UI 表示例

状態：完了

表示される操作

次の作業（編集／新規作成 等）

※ 完了状態は UI 上の便宜的な区切りであり、
将来的に他の状態に統合される可能性がある。


5. エラー種別と対応の整理
5.1 エラー分類
種類	内部条件	UI 状態	対応
業務エラー	audit.result === "NG"	業務エラー	修正（R）
システムエラー	progress.tag === "error"	システムエラー	キャンセル
5.2 R（修正）の意味

R（修正）は、以下の場合にのみ表示される。

業務エラー（監査 NG）の場合

R は、以下を 意味しない。

システムエラーの復旧

処理の再試行

状態のリセット

6. 新規作成の意味

定義

「新規作成」とは、
新しい業務（1 件）の作業を開始することを意味する。

新規作成時の挙動

UI 状態は「未開始」に初期化される

カルテ／マスタは自動的に確定しない

UI は HOME 状態に戻る

UI 表示例

新しい作業を開始しました。
内容の入力を始めてください。

7. カルテ／マスタの位置づけ

カルテ、マスタは 作業対象であり、UI 状態ではない

開いていること＝状態が変わった、ではない

UI 状態は、常に本書の UI 状態定義に従う

8. UI 説明文の原則

UI 上で表示する説明文は、以下を満たさなければならない。

1〜2 行で完結する

「今の状態」と「次にできること」のみを書く

操作手順は書かない

9. 本書の更新ルール

UI 挙動を変更する場合は、本書を先に修正する

index.html 等の UI 実装変更は、本書との差分として行う

master_spec / system_protocol には影響させない

10. 設計原則（まとめ）

UI は状態を語る

ユーザーに判断させない

R は業務修正専用

システムエラーはキャンセルでリセット

説明できない挙動は、設計ミスとみなす

以上。
