<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <?!= HtmlService.createHtmlOutputFromFile('common_ui').getContent(); ?>
</head>
<body onload="checkEnvironment();">
  <div class="app">
    <div class="header">
      <div class="titleWrap">
        <h1 class="title">DOC（書類リクエスト）</h1>
        <p class="subtitle">見積書／請求書／領収書 等のリクエストを Request シートへ記録します（PDF生成はGAS）。</p>
      </div>
      <div class="pill warn">文章補助のみ（判断はGAS）</div>
    </div>

    <div class="card">
      <div class="cardHeader"><h2>入力</h2></div>
      <div class="cardBody">
        <div class="row two">
          <div class="field">
            <label>orderId</label>
            <input id="orderId" type="text" placeholder="orderPrefix-YYYYMMDD-00001-UP...">
          </div>
          <div class="field">
            <label>docType</label>
            <select id="docType">
              <option>見積書</option>
              <option>請求書</option>
              <option>領収書</option>
              <option>その他</option>
            </select>
          </div>
        </div>

        <div class="field">
          <label>docName</label>
          <input id="docName" type="text" placeholder="宛名など">
        </div>
        <div class="field">
          <label>docDesc</label>
          <textarea id="docDesc" placeholder="内容"></textarea>
        </div>
        <div class="row two">
          <div class="field">
            <label>docPrice</label>
            <input id="docPrice" type="number" inputmode="numeric" placeholder="金額">
          </div>
          <div class="field">
            <label>docMemo</label>
            <input id="docMemo" type="text" placeholder="補足">
          </div>
        </div>

        <div class="btns">
          <button class="btn primary" id="btnSubmit" onclick="submitDOC();">送信（Requestへ）</button>
        </div>
      </div>
    </div>
  </div>

<script>
  function submitDOC(){
    var btn = qs('#btnSubmit');
    showBusy(btn, true);
    var payload = {
      orderId: qs('#orderId').value || '',
      docType: qs('#docType').value || '',
      docName: qs('#docName').value || '',
      docDesc: qs('#docDesc').value || '',
      docPrice: qs('#docPrice').value || '',
      docMemo: qs('#docMemo').value || ''
    };
    google.script.run
      .withSuccessHandler(function(res){ showBusy(btn,false); alert('送信しました'); })
      .withFailureHandler(function(err){ showBusy(btn,false); alert('エラー: ' + (err && err.message ? err.message : err)); })
      .formSubmitDOC(payload);
  }
</script>
</body>
</html>
