SYSTEM（system_protocol）

コンパイラ／統治・制御仕様・完全版（汚染ゼロ）

0. 適用範囲と効力宣言（Scope & Authority）

本 system_protocol は、
MASTER（master_spec）を唯一の正として維持・保護・実装・検証するための
統治・制御・監査仕様 である。

本プロトコルは以下のフェーズにのみ効力を持つ。

A（差分統合）

B（編集・分離・再構成）

T（文章・構造監査）

C（生成）

N（内部保持）

D（検知・監査）

R（差戻し・修正）

S（保存・確定）

業務内容・業務ルール・業務データの定義は
一切本書に含めない。

1. 単一正典原則（Single Source of Truth）

唯一の正は MASTER（master_spec） である

system_protocol は master_spec を

編集しない

要約しない

再構成しない

system_protocol は
「どう守るか」「どう壊さないか」 のみを定義する

2. フェーズモデル（A / B / T / C / N / D / R / S）
2.1 各フェーズの責務

A：差分（diff）の統合のみを行う

B：構造整理・分類・再構成を行う

T：矛盾・欠落・汚染の検出を行う

C：master_spec に基づく生成を行う

N：生成物を内部的に保持する

D：破綻・異常・矛盾を検知する

R：修正・差戻しを行う

S：確定物のみを保存する

2.2 禁止事項

フェーズを跨いだ権限侵害

フェーズ外責務の実行

ユーザーによるフェーズ指定の省略要求

3. 差分（diff）運用プロトコル
3.1 差分の唯一性

仕様変更は diff 方式のみ許可

全文再構成・部分編集は禁止

diff は常に「旧 → 新」を明示する

3.2 適用順序

diff 作成（B）

統合（A）

監査（T）

検知（D）

保存（S）

4. Runtime監査プロトコル
4.1 expected effect

実行後に 必ず発生すべき副作用

欠落は Runtime破綻とみなす

4.2 unexpected effect

発生してはならない副作用

発生時は即 NG 判定

4.3 Runtime破綻定義

以下のいずれかを満たす場合、Runtime破綻とする。

expected effect の欠落

unexpected effect の発生

実行対象外領域への影響

5. 自律ループ制御（C→N→D→R→C）

C の生成物は N に保持される

D が監査し NG を検知した場合、R に移行

修正後は再度 C に戻る

OK のみが S に進む

6. 保存・同期ルール（S）

S は「確定した成果物」のみを保持する

S に存在しないものは正式成果物ではない

実装系は S の全文貼替のみ を許可する

7. Runtimeテスト（testModeRuntime）
7.1 テスト原則

テストは本番と完全に分離する

テストデータは業務データと混在させない

7.2 テスト内容

登録

更新

完了

修正

同期

7.3 判定

OK：次フェーズへ

NG：R へ差戻し

8. Rollback / Self-Diff
8.1 Rollback

連続 NG が規定回数に達した場合、
直近の安定版へ自動復元する

8.2 Self-Diff

AI が過去出力との矛盾を検知した場合、
警告のみ を出力する

仕様変更は行わない

9. AI役割制限（SYSTEM側）

AI に許可される行為：

素材抽出

構造監査

差分生成補助

矛盾候補の提示

AI に禁止される行為：

判断

値の確定

master_spec の再構成

業務意味の変更

10. ChatGPT API 利用原則

API は補助層としてのみ利用する

判断・決定は一切行わない

失敗時は安全側に倒す

11. 冪等性（Idempotency）

同一イベントは何度実行しても結果が壊れないこと

重複実行は無視または安全上書きとする

冪等性キーを必須とする

12. スキーマ制御（Payload / Schema）

Payload は定義済みスキーマに一致しなければならない

不一致はエラーとする

暗黙的補完は禁止

13. UI品質監査指標（監査専用）

UI変更は監査対象となる

数値基準は 品質劣化検知のためのみ に用いる

UX要件は master_spec に属する

14. logs/system 制御

すべての監査・検知・破綻を記録する

記録は改変不可

監査証跡として保持する

15. Drive・保存前提制御

保存構造は master_spec を破壊しないための制約として定義

人為的な再配置は禁止

16. 外部統合制御（Todoist / ClickUp / 他）

enabled / disabled の挙動を明確に分離

外部入力は禁止

縮退時も master_spec は破壊しない

17. 禁止事項（SYSTEM）

diff を介さない変更

部分編集

フェーズ無視

AIによる仕様再定義

人的判断の混入

END OF SYSTEM（system_protocol）
